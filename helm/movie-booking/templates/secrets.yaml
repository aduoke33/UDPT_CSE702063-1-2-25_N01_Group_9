apiVersion: v1
kind: Secret
metadata:
  name: {{ include "movie-booking.fullname" . }}-secrets
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "movie-booking.labels" . | nindent 4 }}
type: Opaque
stringData:
  jwt-secret-key: {{ .Values.secrets.jwtSecretKey | quote }}
  
  # Database URLs for each service
  {{- if .Values.localDatabase }}
  auth-database-url: "postgresql+asyncpg://{{ .Values.localDatabase.auth.user }}:{{ .Values.localDatabase.auth.password }}@postgres-auth-service:5432/{{ .Values.localDatabase.auth.database }}"
  movie-database-url: "postgresql+asyncpg://{{ .Values.localDatabase.movie.user }}:{{ .Values.localDatabase.movie.password }}@postgres-movie-service:5432/{{ .Values.localDatabase.movie.database }}"
  booking-database-url: "postgresql+asyncpg://{{ .Values.localDatabase.booking.user }}:{{ .Values.localDatabase.booking.password }}@postgres-booking-service:5432/{{ .Values.localDatabase.booking.database }}"
  payment-database-url: "postgresql+asyncpg://{{ .Values.localDatabase.payment.user }}:{{ .Values.localDatabase.payment.password }}@postgres-payment-service:5432/{{ .Values.localDatabase.payment.database }}"
  notification-database-url: "postgresql+asyncpg://{{ .Values.localDatabase.notification.user }}:{{ .Values.localDatabase.notification.password }}@postgres-notification-service:5432/{{ .Values.localDatabase.notification.database }}"
  {{- else }}
  database-url: {{ include "movie-booking.databaseUrl" . | quote }}
  {{- end }}
  
  # Redis
  {{- if .Values.localRedis }}
  redis-password: {{ .Values.localRedis.password | quote }}
  redis-url: "redis://:{{ .Values.localRedis.password }}@redis-service:6379"
  {{- else }}
  redis-url: {{ include "movie-booking.redisUrl" . | quote }}
  {{- end }}
  
  # RabbitMQ
  {{- if .Values.localRabbitmq }}
  rabbitmq-user: {{ .Values.localRabbitmq.user | quote }}
  rabbitmq-password: {{ .Values.localRabbitmq.password | quote }}
  rabbitmq-url: "amqp://{{ .Values.localRabbitmq.user }}:{{ .Values.localRabbitmq.password }}@rabbitmq-service:5672/"
  {{- else }}
  rabbitmq-url: {{ include "movie-booking.rabbitmqUrl" . | quote }}
  {{- end }}
  
  # SMTP Configuration
  smtp-host: {{ .Values.secrets.smtp.host | quote }}
  smtp-port: {{ .Values.secrets.smtp.port | quote }}
  smtp-user: {{ .Values.secrets.smtp.user | quote }}
  smtp-password: {{ .Values.secrets.smtp.password | quote }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "movie-booking.fullname" . }}-config
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "movie-booking.labels" . | nindent 4 }}
data:
  AUTH_SERVICE_URL: "http://auth-service:8000"
  MOVIE_SERVICE_URL: "http://movie-service:8000"
  BOOKING_SERVICE_URL: "http://booking-service:8000"
  PAYMENT_SERVICE_URL: "http://payment-service:8000"
  NOTIFICATION_SERVICE_URL: "http://notification-service:8000"
  LOG_LEVEL: {{ .Values.authService.env.LOG_LEVEL | default "INFO" | quote }}
  ENVIRONMENT: {{ .Values.namespace | contains "local" | ternary "local" "production" | quote }}
  ALGORITHM: {{ .Values.authService.env.ALGORITHM | default "HS256" | quote }}
  ACCESS_TOKEN_EXPIRE_MINUTES: {{ .Values.authService.env.ACCESS_TOKEN_EXPIRE_MINUTES | default "30" | quote }}
